## 计算机网络复习

### 概述

#### 计算机在信息时代的作用

##### 互联网特点

###### 连通性

###### 资源共享

- 信息共享
- 软件共享
- 硬件共享

#### 互联网概述

##### 基本概念

网络： 由若干结点(node)和连接这些结点的链路(link)组成。

互连网：网络的网络

#### 互联网组成

##### 划分（工作方式）

边缘部分：由所有连接在因特网上的主机组成。这部分是用户直接使用的，用来进行通信和资源共享。

核心部分：由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服务的（提供连通性和交换）。

##### 边缘部分

由各主机构成，用户直接进行信息处理和信息共享;低速连入核心网

##### 核心部分

由各路由器连网，负责为边缘部分提供高速远程分组交换

**客户服务器方式与对等通信方式的主要区别**

前者严格区分服务和被服务者，后者无此区别。后者实际上是前者的双向应用。

##### 数据交换方式

###### 电路交换

三个阶段：建立连接、通信、释放连接

特点：始终占用端到端的通信资源，导致通信线路的利用率很低。

###### 分组交换

- 在发送端，先把较长的报文划分成较短的、固定长度的数据段在每一个数据段前面添加上首部构成分组。
- 分组交换网以“分组”作为数据传输单元，依次把各分组发送到接收端（假定接收端在左边）。
- 接收端收到分组后剥去首部还原成报文
- 最后在接收端把收到的数据恢复成为原来的报文

优点：高效、灵活、迅速、可靠

缺点：转发需要排队，造成时延

###### 报文交换

单个分组交换

#### 计算机网络的类别

##### 分类

* 广域网WAN
* 城域网MAN
* 局域网LAN
* 个人区域网PAN

#### 计算机网络的性能

##### 速率

数据传送速率	b/s		bps

##### 带宽

信道允许通过的信号频带范围

##### 吞吐量

单位时间通过的数据量

##### 时延

发送时延=数据帧长度/发送速率

传播时延=信道长度/传播速率

**eg**：

收 发 两 端 之 间 的 传 输 距 离为 为 1000km，信 号 在 媒 体 上 的 传 播 速 率为 为 2×108m/s。 试 计 算 以 下 两 种 情 况的发送时延和传播时延 ：
（1） 数据长度为 107bit,数据发送速率为 100kb/s。
（2） 数据长度为 103bit,数据发送速率为 1Gb/s。
从 上 面 的 计 算 中 可 以 得 到 什 么 样 的 结 论 ？
解：

（1）发送时延：ts=107/105=100s 传播时延 tp=106/(2×108)=0.005s
（2）发送时延 ts =103/109=1µs 传播时延：tp=106/(2×108)=0.005s
结论：若数据长度大而发送速率低，则在总的时延中，发送时延往往大于传播时延。但若数据长度短而发送速率高，则传播时延就可能是总时延中的主要成分。

##### 时延带宽积

时延带宽积=传播时延x带宽

##### 往返时间

##### 利用率

#### 计算机网络体系结构

##### 网络协议：

为进行网络中的数据交换而建立的规则、标准或约定。由以下三个要素组成：
（1）语法：即数据与控制信息的结构或格式。
（2）语义：即需要发出何种控制信息，完成何种动作以及做出何种响应。
（3）同步：即事件实现顺序的详细说明。

OSI和TCP/IP：[***两种协议详细描述***](https://blog.csdn.net/qq_41923622/article/details/85805003)

1. 应用层：

   应用进程间通信交互

2. 运输层：

   向上一层的进行通信的两个进程之间提供一个可靠的端到端服务，使它们看不见运输层以下的数据通信的细节

   为两台主机进程之间的通信提供通用的数据传输

   TCP：提供面向连接可靠的数据传输服务

   UDP：提供无连接尽最大努力的数据传输服务

3. 网络层:

   选择合适的路由，使 发送站的运输层所传下来的分组能够正确无误地按照地址找到目的站，并交付给目的站的运输层

4. 数据链路层

   在两个相邻结点间的线路上无差错地传送以帧（frame）为单位的数据。每一帧包括数据和必要的控制信息

5. 物理层

   透明地传送比特流。 物理层还要确定连接电缆插头的定义及连接法



### 物理层

**设备：转发器**

**作用：为上层提供比特流的传输服务**

**目的：解决单一bite的传输**

#### 概念：

##### 信道

单向通信(单工)

双向交替通信(半双工)

双向同时通信(全双工)

##### 编码方式

不归零

归零制

曼彻斯特编码：开始边界跳变为0，不跳变为1.

差分曼彻斯特编码

##### 信噪比

信噪比=10 lg(S/N)

C=Wlog2（1+S/N）(b/s)

#### 传输媒体

1. 双绞线

   假定有一种双绞线的衰减是 0.7dB/km(在 1 kHz 时)，若容许有 20dB 的衰减，试问使用这种双绞线的链路的工作距离有多长？如果要双绞线的工作距离增大到 100 公里，试 应当使衰减降低到多少？
   解：使用这种双绞线的链路的工作距离为=20/0.7=28.6km衰减应降低到 20/100=0.2db

2. 同轴电缆

3. 光缆

4. 无线

5. 红外

6. 激光

#### 信道复用技术

##### 频分复用(FDM)

频分多路复用的各用户占用不同的 带宽资源（请注意，这里的“带宽 ”是频率带宽（单位：Hz）而不是 数据的发送速率）
用户在分配到一定的频带后，在通 信过程中自始至终都占用这个频带

![lUzDpQ.png](https://s2.ax1x.com/2020/01/03/lUzDpQ.png)

##### 时分复用

时分复用则是将时间划分为一段段等长的时分复 用帧（TDM 帧），每个用户在每

个 TDM 帧中占 用固定序号的时隙

每用户所占用的时隙是周期性出现（其周期就是 TDM 帧的长度)

时分复用的所有用户是在不同的时间占用相同的 频带宽度

![laSpjA.png](https://s2.ax1x.com/2020/01/03/laSpjA.png)

##### 波分复用

波分复用就是光的频分复用

![laSkAf.png](https://s2.ax1x.com/2020/01/03/laSkAf.png)

##### 码分复用

广泛应用于无线链路共享 (如蜂窝网,卫星通信等) 

每个用户分配一个唯一的m bit 码片序列(chipping sequence)，其中“0”用“-1”表示、“1”用“+1”表示

各用户使用相同频率载波，利用各自码片序列编码数据

编码信号 = (原始数据) × (码片序列)

解码: 码片序列与编码信号的内积

![laSAN8.png](https://s2.ax1x.com/2020/01/03/laSAN8.png)

码分多址址CDMA为为什么可以使所有用户在同样的时间使用同样的频带进行通 信而不会互相干扰？这种复用方法有何优缺点 ？
答：各用户使用经过特殊挑选的相互正交的不同码型，因此彼此不会造成干扰。 这种系统发送的信号有很强的抗干扰能力，其频谱类似于白噪声，不易被敌人发现。占用较大的带宽。

### 数据链路层

**设备：桥接器，交换机**

**负责通过一条链路从一个节点向另一个物理链路直接相连的相邻结点传送数据报以帧作为数据单位**

#### 数据链路层服务

**组帧**

封装数据报构成数据帧，加首部和尾部 

帧同步

**链路接入**

帧首部中的“MAC”地址，用于标识帧的源和目的

**相邻结点间可靠交付**

线链路：误码率高，需要可靠交付

**流量控制**

协调相邻的发送结点和接收

**差错检测**

信号衰减和噪声会引起差错

接收端检测到差错:	通知发送端重传或者直接丢弃帧

**差错纠正**

接收端直接纠正比特差错

**全双工和半双工通信控制**

全双工：链路两端结点同时双向传输

半双工：链路两端结点交替双向传输

![larDPJ.png](https://s2.ax1x.com/2020/01/03/larDPJ.png)

#### 点对点

##### 通信基本步骤：

1. 结点A的数据链路层把网络层的IP数据报添加首尾封装成帧。
2. 结点A把帧发给结点B的数据链路层。
3. 结点B判断帧无差错则提取出IP数据报交给网络层，否则丢弃帧。

##### 三个基本问题

###### 封装成帧

网络层IP数据报作为帧数据部分加上头部和尾部。

帧定界：帧开始符SOH，结束符：EOT

###### 透明传输

通过字节填充插入转义字符解决数据中存在帧定界

###### 差错检测

循环冗余检查

在数据后面添加冗余码

#### PPP协议

##### 满足要求

简单、封装成帧、透明性、多种网络层协议、多种类型链路、差错检测、检测连接状态、最大传送单

元、网络层地址协商、数据压缩协商

##### 帧格式

###### PPP帧的首部

首部中的标志字段F(Flag)，规定为0x7E，标志字段表示一个帧的开始。

首部中的地址字段A规定为0xFF。

首部中的控制字段C规定为0x03。

首部中的2字节的协议字段：

1. **当协议字段为0x0021时，PPP帧的信息字段就是IP数据报。**
2. **当协议字段为0xC021时，PPP帧的信息字段就是PPP链路控制协议LCP的数据。**
3. **当协议字段为0x8021时，PPP帧的信息字段就是网络层的控制数据。**

###### PPP帧的信息字段部分

信息字段的长度是可变的，不超过1500字节。

###### PPP帧的尾部

尾部中的第一个字段(2个字节)是使用CRC的帧检验序列FCS。

尾部中的标志字段F(Flag)，规定为0x7E，标志字段表示一个帧的结束。

**注意：标志字段就是PPP帧的定界符。连续两帧之间只需要用一个标志字段。如果连续出现两个标志字段，就表示这是一个空帧，应当丢弃。**

![laRke1.png](https://s2.ax1x.com/2020/01/03/laRke1.png)

##### 字节填充——PPP使用异步传输

当PPP使用异步传输时，它把转移符定义为0x7D，并使用字节填充。

RFC1662规定了如下填充方法：

(1)把信息字段中出现的每一个0x7E字节转变为2字节序列(0x7D，0x5E)。

(2)若信息字段中出现一个0x7D的字节(即出现了和转义字符一样的比特组合)，则把转义字符0x7D转

变为2字节序列(0x7D，0x5D)。

(3)若信息字段中出现ASCII码的控制字符(即数值小于0x20的字符)，则在该字符前面要加入一个0x7D

字节，同时将该字符的编码加以改变。例如，出现0x03(在控制字符中是“传输结束”ETX)就要把它转变

为2字节序列的(0x7D，0x31)。

由于在发送端进行了字节填充，因此在链路上传送的信息字节数就超过了原来的信息字节数。但接收

端在接收到数据后再进行与发送端字节填充相反的变换，就可以正确地恢复出原来的信息。

**eg：**

一个PPP帧的数据部分（ 用十六进制写出）是7D 5E FE 27 7D 5D 7D 5D 65 7D 5E。

PPP协议，7E→7D 5E,7D→7D 5D
当信息字段中出现和标志字段一样的比特0x7E时，就必须采取一些措施。因PPP协议是面向字符型的，所以它不能采用HDLC所使用的零比特插入法，而是使用一种特殊的字符填充。具体的做法是将信息字段中出现的每一个0x7E字节转变成2字节序列（0x7D，0x5E）。若信息字段中出现一个0x7D的字节，则将其转变成2字节序列（0x7D，0x5D）。若信息字段中出现ASCII码的控制字符，则在该字符前面要加入一个0x7D字节。这样做的目的是防止这些表面上的ASCII码控制字符被错误地解释为控制字符。
真正的16进制数据是7E FE 27 7D 7D 65 7E

##### 零比特填充——PPP使用同步传输

当PPP使用同步传输时，用零比特填充。

零比特填充的具体方法：

(1)在发送端先扫描整个信息字段(通常使用硬件实现，但也可以用软件实现，但是会慢一些)。

(2)只要发现有5个连续的1，则立即填入一个0。

(3)接收端在收到一个帧时，先找到标志字段F以确定帧的边界，接着再用硬件对其中的比特流进行扫

描，每当发现5个连续1时，就把5个连续1后的一个0删除，以还原成原来的信息比特流。

因此通过这种零比特填充后的数据，就可以保证在信息字段中不会出现连续6个1。

**eg：**

比特填充法的具体做法是：在发送端，当一串比特流尚未加上标志字段时，先用硬件扫描整个帧。只要发现5个连续1，则立即填入一个0。因此经过这种零比特填充后的数据，就可以保证不会出现6个连续1。在接收一个帧时，先找到F字段以确定帧的边界。接着再用硬件对其中的比特流进行扫描。每当发现5个连续1时，就将这5个连续1后的一个0删除，以还原成原来的比特流。

发送端的数据0110111111111100经过零比特填充是011011111011111000
接收端收到的0001110111110111110110删除零后是00011101111111111110

#### 局域网

##### MAC协议分类

信道划分MAC协议

随机访问MAC协议

轮转MAC协议

##### CSMA/CD算法

**边发边听，不发不听**

1. NIC从网络层接收数据报 ，创建数据帧。
2. 监听信道： 如果NIC监听到信道空闲 ，则开始发送帧； 如果NIC监听到信道忙， 则一直等待到信道空闲 ，然后发送帧。
3. NIC发送完整个帧，而没有检测到其他结点的数据发送，则NIC确认帧发送成功！
4. 如果NIC检测到其他结点传输数据，则中止发送，并发送堵塞信号
5. 中止发送后，NIC进入二 进制指数退避。

##### 以太网MAC地址

e.g.: 1A-2F-BB-76-09-AD

MAC地址：身份证号

IP地址：邮政地址

MAC帧格式

![lwzlxe.png](https://s2.ax1x.com/2020/01/04/lwzlxe.png)

### 网络层

**设备：路由器**

**核心功能-转发与路由**

**网际协议IP**

- ARP
- ICMP
- IGMP

#### IP地址

##### 分类

[![l0ksUJ.md.jpg](https://s2.ax1x.com/2020/01/04/l0ksUJ.md.jpg)](https://imgchr.com/i/l0ksUJ)

区别

[![l0kg81.md.jpg](https://s2.ax1x.com/2020/01/04/l0kg81.md.jpg)](https://imgchr.com/i/l0kg81)

#### ARP协议

A想要给同一局域网内的 B发送数据报 

B的MAC地址不在 A的 ARP 表中.

A广播ARP查询分组，其 中包含B的IP地址 

 	目的MAC地址 = FF-FFFF-FF-FF-FF

 LAN中所有结点都会接收 ARP查询

B接收ARP查询分组，IP 地址匹配成功，向A应答 B的MAC 地址 

​	利用单播帧向A发送应答

 A在其ARP表中，缓存B的 IP-MAC地址对，直至超时

​	 超时后，再次刷新

ARP是“即插即用”协议: 

 	结点自主创建ARP表， 无需干预

#### IP数据报格式

[数据报格式详细](https://www.jianshu.com/p/d3f9e70c6220)

#### 划分子网



#### RIP





### 运输层

**TCP/IP**

- UDP
- TCP

[![l0mjrq.md.png](https://s2.ax1x.com/2020/01/04/l0mjrq.md.png)](https://imgchr.com/i/l0mjrq)

#### UDP

特点：

- 无连接 不用在数据传输之前进行连接和释放连接。

- 尽最大努力交付

- 面向报文 既不合并，也不拆分。

[![l0KhrR.md.png](https://s2.ax1x.com/2020/01/04/l0KhrR.md.png)](https://imgchr.com/i/l0KhrR)

#### TCP

- [ ] 

###### 面向连接

通信双方必须先建立连接才能进行数据的传输，双方都必须为该连接分配必要的系统内核资源，以管理连接

的状态和连接上的传输。

双方间的数据传输都可以通过这一个连接进行。

完成数据交换后，双方必须断开此连接，以释放系统资源。

这种连接是一对一的，因此TCP不适用于广播的应用程序，基于广播的应用程序请使用UDP协议。

###### 可靠传输

1. TCP采用发送应答机制

   TCP发送的每个报文段都必须得到接收方的应答才认为这个TCP报文段传输成功

2. 超时重传

   发送端发出一个报文段之后就启动定时器，如果在定时时间内没有收到应答就重新发送这个报文段。

   TCP为了保证不发生丢包，就给每个包一个序号，同时序号也保证了传送到接收端实体的包的按序接收。然后接收端实体对已成功收到的包发回一个相应的确认（ACK）；如果发送端实体在合理的往返时延（RTT）内未收到确认，那么对应的数据包就被假设为已丢失将会被进行重传。

3. 错误校验

   TCP用一个校验和函数来检验数据是否有错误；在发送和接收时都要计算校验和。

4. 流量控制和阻塞管理

   流量控制用来避免主机发送得过快而使接收方来不及完全收下。

TCP报文格式

![l0lvL9.png](https://s2.ax1x.com/2020/01/04/l0lvL9.png)

#### TCP连接

##### 三次握手

### 应用层

#### 域名系统DNS

##### 域名解析过程

###### 迭代查询

###### 递归查询

#### 文件传送协议FTP

###### FTP主进程的工作步骤：

1. 开熟知端口（21），使客户进程能够连接上

2. 等待客户进程发送连接请求

3. 启动从属进程来处理客户进程发来的请求

4. 回到等待状态，继续接受其他客户进程发来的请求

#### 电子邮件

##### SMTP邮件发送协议

1. 连接建立

2. 邮件发送
3. 连接释放

##### POP3邮件读取协议

从POP3服务器读取后，服务器就删除邮件

##### IMAP邮件发送协议

允许读取邮件一部分，邮件保存在IMAP服务器，需联网查看

##### MIME通用互联网邮件扩充

#### 动态主机配置协议DHCP

##### 作用

主要通过在网络中配置DHCP服务器为网络中的计算机自动分配指定的网段IP地址，并配置一些IP选

项，如：子网掩码、默认网关等



























